<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chain Receipt - Transaction Receipt {{BILL_ID}}</title>
    <style>
        /* ==================== GLOBAL RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @page {
            size: A4;
            /* Puppeteer sets the real margins (40mm/80px etc) */
            margin: 0;
        }

        @page :first {
            margin: 15mm 15mm 20mm 15mm;
        }

        /* Page counter */
        body {
            counter-reset: page;
        }

        :root {
            /* Brand Colors */
            --primary-purple: #7c3aed;
            --primary-purple-dark: #6d28d9;
            --primary-purple-light: #a78bfa;

            /* Semantic Colors */
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #3b82f6;
            --info-light: #dbeafe;

            /* Neutral Palette */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            /* Typography */
            --font-primary: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
            --font-mono: 'Consolas', 'Monaco', 'Courier New', monospace;

            /* Spacing Scale */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: var(--font-primary);
            font-size: 11px;
            line-height: 1.6;
            color: var(--gray-800);
            background: white;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .page {
            width: 100%;
            /* Let Puppeteer's margins dictate the width */
            min-height: 100vh;
            /* Fill the view */
            background: white;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .page-content {
            flex: 1;
        }

        /* ==================== PAGE BREAK CONTROLS ==================== */
        /* Prevent breaking inside these elements */
        .header,
        .network-banner,
        .info-card,
        .address-component,
        .smart-table,
        .totals-group,
        .feature-total,
        .footer-group,
        .section-header,
        /* Keep header with its content */
        .items-section,
        .fees-section {
            page-break-inside: avoid;
            break-inside: avoid;
        }

        /* 
           Compensate for Puppeteer's 80px Top Margin on Page 1.
           Since Puppeteer pushes EVERYTHING down by 80px, the visual header needs to "pull up" 
           into that whitespace if we want it to look normal, OR we accept the 80px whitespace.
           
           Since Pass 1 has displayHeaderFooter: false, the top 80px is just white space.
           We can safely let the content start there.
        */
        @page {
            /* We let Puppeteer control margins now */
            margin: 0;
        }

        .footer-group {
            width: 100%;
            margin-top: auto;
        }

        .audit-item {
            page-break-inside: avoid;
            break-inside: avoid;
        }

        /* Allow breaking before major sections if needed */
        .transaction-section,
        .participants-section,
        .totals-section {
            page-break-before: auto;
            break-before: auto;
        }

        /* Keep table rows together */
        .table-row {
            page-break-inside: avoid;
            break-inside: avoid;
        }

        /* Prevent orphan headers */
        h2,
        h3,
        .section-title {
            page-break-after: avoid;
            break-after: avoid;
        }


        /* ==================== HEADER SECTION ==================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            /* 
               We have unified top margin to 80px (approx 21mm) to match Page 2.
               Standard A4 print margin is often 15-20mm. 
               Puppeteer: 80px = ~21mm. 
               The header is now pushed down by 80px whitespace.
               We can pull it up slightly if it feels too low, or leave it.
               Let's reduce the bottom margin slightly to tighten the rhythm.
            */
            margin-bottom: var(--space-lg);
            /* Was xl */
            padding-bottom: var(--space-md);
            /* Was lg */
            border-bottom: 3px solid var(--primary-purple);
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 120px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-purple) 0%, transparent 100%);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-purple-dark) 100%);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: var(--shadow-md);
        }

        .logo-text-wrapper {
            display: flex;
            flex-direction: column;
        }

        .logo-text {
            font-size: 26px;
            font-weight: 700;
            color: var(--gray-900);
            letter-spacing: -0.8px;
        }

        .logo-tagline {
            font-size: 9px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .bill-meta {
            text-align: right;
        }

        .bill-number {
            font-size: 10px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-xs);
        }

        .bill-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
            letter-spacing: -0.5px;
        }

        .bill-date {
            font-size: 11px;
            color: var(--gray-600);
            margin-bottom: var(--space-md);
        }

        /* ==================== STATUS & TYPE BADGES ==================== */
        .badges {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
            flex-wrap: wrap;
            align-items: center;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .badge-icon {
            font-size: 12px;
        }

        .badge-confirmed {
            background: var(--success-light);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-provisional {
            background: var(--warning-light);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge-pending {
            background: var(--info-light);
            color: var(--info);
            border: 1px solid var(--info);
        }

        .badge-failed {
            background: var(--danger-light);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge-type {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            color: var(--primary-purple-dark);
            border: 1px solid var(--primary-purple-light);
        }

        .badge-technical {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            color: #0369a1;
            border: 1px solid #7dd3fc;
        }

        .badge-security {
            background: linear-gradient(135deg, #ecfccb 0%, #d9f99d 100%);
            color: #3f6212;
            border: 1px solid #bef264;
        }

        /* ==================== ALERT BANNER ==================== */
        .alert-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--warning);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .alert-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
            font-size: 12px;
        }

        .alert-message {
            color: var(--gray-700);
            font-size: 10px;
            line-height: 1.5;
        }

        /* ==================== NETWORK BANNER ==================== */
        .network-banner {
            background: linear-gradient(135deg, var(--info-light) 0%, #bfdbfe 100%);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid var(--info);
        }

        .network-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .network-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-sm);
        }

        .network-details h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--info);
            margin-bottom: var(--space-xs);
        }

        .network-details p {
            font-size: 10px;
            color: var(--gray-600);
        }

        .network-stats {
            text-align: right;
        }

        .network-stat {
            margin-bottom: var(--space-xs);
        }

        .network-stat-label {
            font-size: 9px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .network-stat-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-900);
        }

        /* ==================== SECTION FRAMEWORK ==================== */
        .section {
            /* Standardize vertical gap */
            margin-bottom: var(--space-lg);
            /* Was xl - tighten up */
            page-break-inside: avoid;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
            /* Was md */
            padding-bottom: var(--space-xs);
            /* Was sm */
            border-bottom: 2px solid var(--gray-200);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .section-icon {
            font-size: 20px;
            color: var(--primary-purple);
        }

        .section-action {
            font-size: 10px;
            color: var(--primary-purple);
            text-decoration: none;
            font-weight: 600;
        }

        /* ==================== INFO GRID SYSTEM ==================== */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
        }

        .info-grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .info-grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .info-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            transition: all 0.2s ease;
        }

        .info-card-highlight {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: var(--primary-purple-light);
        }

        .info-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 9px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .info-label-icon {
            font-size: 12px;
        }

        .info-value {
            font-size: 13px;
            color: var(--gray-900);
            font-weight: 600;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        .info-value-large {
            font-size: 18px;
            font-weight: 700;
        }

        .info-value-mono {
            font-family: var(--font-mono);
            font-size: 11px;
            background: white;
            padding: 8px 10px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-200);
            display: block;
            margin-top: 4px;
        }

        .info-subtext {
            font-size: 9px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        /* ==================== ADDRESS COMPONENT ==================== */
        .address-component {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            background: white;
            padding: 10px;
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }

        .address-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary-purple-light) 0%, var(--primary-purple) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
            flex-shrink: 0;
        }

        .address-details {
            flex: 1;
            min-width: 0;
        }

        .address-label {
            font-size: 9px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .address-value {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--gray-900);
            font-weight: 600;
        }

        .address-ens {
            font-size: 10px;
            color: var(--primary-purple);
            font-weight: 600;
        }

        /* ==================== ADVANCED TABLE SYSTEM ==================== */
        .table-wrapper {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow-x: auto;
            margin-top: var(--space-md);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table thead {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
        }

        .table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 9px;
            font-weight: 700;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-200);
            white-space: nowrap;
        }

        .table th:first-child {
            border-top-left-radius: var(--radius-lg);
        }

        .table th:last-child {
            border-top-right-radius: var(--radius-lg);
        }

        .table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--gray-100);
            font-size: 11px;
            color: var(--gray-800);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .table tbody tr:hover {
            background: var(--gray-50);
        }

        .table-cell-icon {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-icon {
            font-size: 16px;
        }

        .table-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .table-badge-in {
            background: var(--success-light);
            color: var(--success);
        }

        .table-badge-out {
            background: var(--danger-light);
            color: var(--danger);
        }

        .table-value-positive {
            color: var(--success);
            font-weight: 700;
        }

        .table-value-negative {
            color: var(--danger);
            font-weight: 700;
        }

        .table-mono {
            font-family: var(--font-mono);
            font-size: 10px;
            background: var(--gray-50);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }

        /* ==================== SUMMARY CARD SYSTEM ==================== */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .summary-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
        }

        .summary-card-success {
            border-color: var(--success);
            background: linear-gradient(135deg, var(--success-light) 0%, white 100%);
        }

        .summary-card-danger {
            border-color: var(--danger);
            background: linear-gradient(135deg, var(--danger-light) 0%, white 100%);
        }

        .summary-card-warning {
            border-color: var(--warning);
            background: linear-gradient(135deg, var(--warning-light) 0%, white 100%);
        }

        .summary-icon {
            font-size: 32px;
            margin-bottom: var(--space-sm);
        }

        .summary-label {
            font-size: 10px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
            margin-bottom: var(--space-xs);
        }

        .summary-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }

        .summary-subtext {
            font-size: 9px;
            color: var(--gray-500);
        }

        /* ==================== TOTALS FEATURE SECTION ==================== */
        .totals-feature {
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--primary-purple-dark) 100%);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            color: white;
            margin-top: var(--space-xl);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .totals-feature::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .totals-header {
            text-align: center;
            margin-bottom: var(--space-xl);
            position: relative;
            z-index: 1;
        }

        .totals-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .totals-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-xl);
            margin-bottom: var(--space-xl);
            position: relative;
            z-index: 1;
        }

        .total-item {
            text-align: center;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .total-icon {
            font-size: 28px;
            margin-bottom: var(--space-sm);
        }

        .total-label {
            font-size: 10px;
            opacity: 0.9;
            margin-bottom: var(--space-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .total-value {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .total-subvalue {
            font-size: 10px;
            opacity: 0.8;
        }

        .net-change-section {
            text-align: center;
            padding: var(--space-xl) var(--space-lg);
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .net-change-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .net-change-value {
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .net-change-description {
            font-size: 10px;
            opacity: 0.8;
            margin-top: var(--space-sm);
        }

        /* ==================== AUDIT & VERIFICATION ==================== */
        .audit-section {
            background: linear-gradient(135deg, var(--warning-light) 0%, #fef9c3 100%);
            border: 1px solid var(--warning);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-top: var(--space-xl);
            margin-bottom: var(--space-xl);
            page-break-inside: avoid;
            break-inside: avoid;
        }

        .audit-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .audit-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-sm);
        }

        .audit-title {
            flex: 1;
        }

        .audit-title h3 {
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 2px;
        }

        .audit-title p {
            font-size: 10px;
            color: var(--gray-600);
        }

        .audit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .audit-item {
            background: white;
            padding: var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }

        .confidence-meter {
            /* Align with audit-item */
            background: white;
            padding: var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
            height: 100%;
            /* Fill height */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .confidence-label {
            /* Match info-label */
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 9px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .confidence-bar-wrapper {
            position: relative;
            height: 12px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .confidence-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--warning) 50%, var(--danger) 100%);
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
            position: relative;
        }

        .confidence-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                transform: translateX(-100%);
            }

            50% {
                transform: translateX(100%);
            }
        }

        .confidence-value {
            text-align: center;
            margin-top: var(--space-sm);
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }

        /* ==================== AD SECTION (LEADERBOARD 728x90) ==================== */
        .ad-section {
            width: 728px;
            height: auto;
            min-height: 90px;
            margin: var(--space-2xl) auto;
            padding: 0;
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border: 2px dashed var(--primary-purple-light);
            border-radius: var(--radius-lg);
            display: block;
            text-align: center;
            overflow: hidden;
            page-break-inside: avoid;
        }

        .ad-title {
            display: none;
        }

        .ad-content {
            width: 100%;
            min-height: 90px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-sm);
        }

        .ad-content iframe,
        .ad-content img {
            max-width: 728px !important;
            max-height: 90px !important;
        }

        .ad-placeholder {
            padding: var(--space-md);
            color: var(--gray-600);
            text-align: center;
        }

        .ad-placeholder-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-purple);
            margin-bottom: 2px;
        }

        .ad-placeholder-text {
            font-size: 9px;
            color: var(--gray-500);
        }

        .ad-placeholder-link {
            display: inline-block;
            margin-top: 4px;
            padding: 4px 12px;
            background: var(--primary-purple);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 11px;
        }

        /* ==================== QR CODE & VERIFICATION ==================== */
        .verification-section {
            margin-top: var(--space-2xl);
            padding-top: var(--space-xl);
            border-top: 2px dashed var(--gray-300);
            text-align: center;
        }

        .verification-title {
            font-size: 12px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: var(--space-lg);
        }

        .qr-container {
            display: inline-block;
            padding: var(--space-lg);
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .qr-code {
            width: 140px;
            height: 140px;
            margin: 0 auto var(--space-md);
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-code img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .qr-label {
            font-size: 9px;
            color: var(--gray-600);
            line-height: 1.4;
        }

        .qr-link {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--primary-purple);
            text-decoration: none;
            word-break: break-all;
            display: block;
            margin-top: var(--space-xs);
        }

        /* ==================== FOOTER SYSTEM ==================== */
        .footer {
            margin-top: var(--space-2xl);
            padding-top: var(--space-xl);
            border-top: 2px solid var(--gray-200);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .footer-section h4 {
            font-size: 11px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer-section p {
            font-size: 9px;
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: var(--space-xs);
        }

        .footer-link {
            color: var(--primary-purple);
            text-decoration: none;
            font-weight: 600;
        }

        .footer-link:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            text-align: center;
            padding-top: var(--space-md);
            border-top: 1px solid var(--gray-200);
            font-size: 9px;
            color: var(--gray-500);
        }

        .footer-legal {
            margin-top: var(--space-sm);
            font-size: 8px;
            line-height: 1.5;
        }

        /* ==================== RUNNING HEADER (Pages 2+) ==================== */
        .first-page-header {
            page-break-after: avoid;
        }

        .running-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            margin-bottom: var(--space-lg);
            background: white;
            border-bottom: 2px solid var(--primary-purple-light);
            page-break-before: always;
            page-break-after: avoid;
        }

        .running-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .running-header-logo {
            font-size: 16px;
        }

        .running-header-brand {
            font-weight: 700;
            font-size: 12px;
            color: var(--gray-900);
        }

        .running-header-right {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 10px;
            color: var(--gray-600);
        }

        .bill-id-small {
            font-weight: 600;
            color: var(--gray-700);
        }

        .page-number::before {
            content: "Page " counter(page);
        }

        /* ==================== UTILITY CLASSES ==================== */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .text-success {
            color: var(--success);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-warning {
            color: var(--warning);
        }

        .text-muted {
            color: var(--gray-500);
        }

        .font-bold {
            font-weight: 700;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-mono {
            font-family: var(--font-mono);
        }

        .mb-xs {
            margin-bottom: var(--space-xs);
        }

        .mb-sm {
            margin-bottom: var(--space-sm);
        }

        .mb-md {
            margin-bottom: var(--space-md);
        }

        .mb-lg {
            margin-bottom: var(--space-lg);
        }

        .mt-xs {
            margin-top: var(--space-xs);
        }

        .mt-sm {
            margin-top: var(--space-sm);
        }

        .mt-md {
            margin-top: var(--space-md);
        }

        .mt-lg {
            margin-top: var(--space-lg);
        }

        /* ==================== PRINT OPTIMIZATION ==================== */
        @media print {
            .page {
                margin: 0;
                box-shadow: none;
            }

            .section {
                page-break-inside: avoid;
            }

            .no-print {
                display: none;
            }
        }

        /* ==================== RESPONSIVE (for screen preview) ==================== */
        @media screen and (max-width: 768px) {

            .info-grid,
            .info-grid-3,
            .info-grid-4 {
                grid-template-columns: 1fr;
            }

            .totals-grid,
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="page">
        <!-- Main Header (Page 1 only) -->
        <div class="first-page-header">
            <!-- ==================== HEADER ==================== -->
            <header class="header">
                <div class="logo-section">
                    <div class="logo-icon">‚ö°</div>
                    <div class="logo-text-wrapper">
                        <div class="logo-text">Chain Receipt</div>
                        <div class="logo-tagline">Blockchain Transaction Receipts</div>
                    </div>
                </div>

                <div class="bill-meta">
                    <div class="bill-number">Bill #{{BILL_ID}}</div>
                    <h1 class="bill-title">Transaction Receipt</h1>
                    <div class="bill-date">Generated: {{GENERATED_AT}}</div>
                    <div class="badges">
                        <span class="badge {{#if STATUS_CONFIRMED}}badge-confirmed{{else}}badge-failed{{/if}}">
                            <span class="badge-icon">{{#if STATUS_CONFIRMED}}‚úî{{else}}‚úñ{{/if}}</span>
                            {{#if STATUS_CONFIRMED}}Confirmed{{else}}Failed{{/if}}
                        </span>
                        <span class="badge badge-type">
                            <span class="badge-icon">{{TYPE_ICON}}</span>
                            {{TYPE_READABLE}}
                        </span>
                        {{#if IS_MULTISIG}}
                        <span class="badge badge-security">
                            <span class="badge-icon">üîê</span>
                            Multisig
                        </span>
                        {{/if}}
                        {{#if IS_SMART_ACCOUNT}}
                        <span class="badge badge-security">
                            <span class="badge-icon">üõ°Ô∏è</span>
                            Smart Account
                        </span>
                        {{/if}}
                        {{#if ENVELOPE_LABEL}}
                        <span class="badge badge-technical">
                            <span class="badge-icon">‚úâÔ∏è</span>
                            {{ENVELOPE_LABEL}}
                        </span>
                        {{/if}}
                    </div>
                </div>
            </header>
        </div>
        <!-- End first-page-header -->

        <!-- Running Header for Pages 2+ -->
        <div class="running-header">
            <div class="running-header-left">
                <span class="running-header-logo">‚ö°</span>
                <span class="running-header-brand">Chain Receipt</span>
            </div>
            <div class="running-header-right">
                <span class="bill-id-small">Bill #{{BILL_ID}}</span>
                <span class="page-number"></span>
            </div>
        </div>

        <div class="page-content">
            <!-- ==================== PROVISIONAL WARNING (conditional) ==================== -->
            {{#if STATUS_PROVISIONAL}}
            <div class="alert-banner">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-content">
                    <div class="alert-title">Provisional Transaction Status</div>
                    <div class="alert-message">
                        This transaction has {{CONFIRMATIONS}} confirmations. We recommend waiting for at least
                        {{REQUIRED_CONFIRMATIONS}} confirmations before considering this transaction final. The data in
                        this
                        bill may change if a blockchain reorganization occurs.
                    </div>
                </div>
            </div>
            {{/if}}

            <!-- ==================== NETWORK BANNER ==================== -->
            <div class="network-banner">
                <div class="network-info">
                    <div class="network-icon">{{CHAIN_ICON}}</div>
                    <div class="network-details">
                        <h3>{{CHAIN_NAME}} Network</h3>
                        <p>Chain ID: {{CHAIN_ID}} ‚Ä¢ Native Token: {{CHAIN_SYMBOL}}</p>
                    </div>
                </div>
                <div class="network-stats">
                    <div class="network-stat">
                        <div class="network-stat-label">Block Height</div>
                        <div class="network-stat-value">{{BLOCK_NUMBER}}</div>
                    </div>
                    <div class="network-stat">
                        <div class="network-stat-label">Confirmations</div>
                        <div class="network-stat-value">{{CONFIRMATIONS}}</div>
                    </div>
                </div>
            </div>

            <!-- ==================== INTERNAL TRANSACTIONS ==================== -->
            {{#if HAS_INTERNAL_TXS}}
            <div class="section items-section" style="margin-top: 20px;">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">‚öôÔ∏è</span>
                        <span>Internal Execution</span>
                    </div>
                    <div style="font-size: 10px; color: var(--gray-500); font-weight: 600;">
                        Smart Contract Operations
                    </div>
                </div>

                <table class="table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th style="width: 35%;">Sender</th>
                            <th style="width: 35%;">Receiver</th>
                            <th style="width: 30%; text-align: right;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each INTERNAL_TXS}}
                        <tr class="table-row">
                            <td>
                                <div class="table-mono">{{this.fromShort}}</div>
                            </td>
                            <td>
                                <div class="table-mono">{{this.toShort}}</div>
                            </td>
                            <td style="text-align: right;">
                                <span class="table-value-positive"
                                    style="color: var(--gray-800);">{{this.amount}}</span>
                                <span style="font-size: 9px; color: var(--gray-500);">{{this.symbol}}</span>
                                {{#if this.isError}}
                                <span class="table-badge table-badge-out" style="margin-left: 5px;">FAIL</span>
                                {{/if}}
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{/if}}

            <!-- ==================== TRANSACTION OVERVIEW ==================== -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìä</span>
                        Transaction Overview
                    </h2>
                    <a href="{{EXPLORER_URL}}" class="section-action">View on Explorer ‚Üí</a>
                </div>

                <div class="info-grid">
                    <div class="info-card info-card-highlight">
                        <div class="info-label">
                            <span class="info-label-icon">üîó</span>
                            Transaction Hash
                        </div>
                        <div class="info-value info-value-mono">{{TRANSACTION_HASH}}</div>
                        <div class="info-subtext">Unique blockchain identifier</div>
                    </div>

                    <div class="info-card">
                        <div class="info-label">
                            <span class="info-label-icon">üì¶</span>
                            Block Number
                        </div>
                        <div class="info-value info-value-large">{{BLOCK_NUMBER}}</div>
                        <div class="info-subtext">Block Hash: {{BLOCK_HASH_SHORT}}</div>
                    </div>

                    <div class="info-card">
                        <div class="info-label">
                            <span class="info-label-icon">üïê</span>
                            Timestamp
                        </div>
                        <div class="info-value">{{TIMESTAMP}}</div>
                        <div class="info-subtext">{{TIMESTAMP_RELATIVE}}</div>
                    </div>

                    <div class="info-card">
                        <div class="info-label">
                            <span class="info-label-icon">‚úì</span>
                            Confirmations
                        </div>
                        <div class="info-value info-value-large">{{CONFIRMATIONS}}</div>
                        <div class="info-subtext">Required: {{REQUIRED_CONFIRMATIONS}}</div>
                    </div>
                </div>
            </section>

            <!-- ==================== PARTICIPANTS ==================== -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üë•</span>
                        Transaction Participants
                    </h2>
                </div>

                <div class="info-grid">
                    <div class="address-component">
                        <div class="address-avatar">{{FROM_AVATAR}}</div>
                        <div class="address-details">
                            <div class="address-label">Sender</div>
                            {{#if FROM_ENS}}
                            <div class="address-ens">{{FROM_ENS}}</div>
                            {{/if}}
                            <div class="address-value">{{FROM_ADDRESS}}</div>
                        </div>
                    </div>

                    <div class="address-component">
                        <div class="address-avatar">{{TO_AVATAR}}</div>
                        <div class="address-details">
                            <div class="address-label">Recipient</div>
                            {{#if TO_ENS}}
                            <div class="address-ens">{{TO_ENS}}</div>
                            {{/if}}
                            <div class="address-value">{{TO_ADDRESS}}</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== TRANSACTION ITEMS ==================== -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üí∏</span>
                        Token Movements
                    </h2>
                    <span class="section-action">{{ITEMS_COUNT}} items</span>
                </div>

                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Direction</th>
                                <th>Token</th>
                                <th>From</th>
                                <th>To</th>
                                <th style="text-align: right;">Amount</th>
                                <th style="text-align: right;">USD Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each ITEMS}}
                            <tr>
                                <td>
                                    <span class="table-badge table-badge-{{this.direction}}">
                                        {{#if this.isIn}}‚Üì IN{{else}}‚Üë OUT{{/if}}
                                    </span>
                                </td>
                                <td>
                                    <div class="table-cell-icon">
                                        <span class="table-icon">{{this.tokenIcon}}</span>
                                        <span>{{this.tokenSymbol}}</span>
                                    </div>
                                </td>
                                <td><span class="table-mono">{{this.fromShort}}</span></td>
                                <td><span class="table-mono">{{this.toShort}}</span></td>
                                <td style="text-align: right;">{{this.amountFormatted}}</td>
                                <td style="text-align: right;" class="table-value-{{this.direction}}">
                                    {{this.usdValue}}
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ==================== GAS FEES ==================== -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">‚õΩ</span>
                        Transaction Fees
                    </h2>
                </div>

                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="summary-icon">üî•</div>
                        <div class="summary-label">Gas Used</div>
                        <div class="summary-value">{{GAS_USED}}</div>
                        <div class="summary-subtext">units</div>
                    </div>

                    <div class="summary-card">
                        <div class="summary-icon">üíé</div>
                        <div class="summary-label">Gas Price</div>
                        <div class="summary-value">{{GAS_PRICE}}</div>
                        <div class="summary-subtext">{{GAS_PRICE_GWEI}} Gwei</div>
                    </div>

                    <div class="summary-card summary-card-warning">
                        <div class="summary-icon">üí∞</div>
                        <div class="summary-label">Total Fee</div>
                        <div class="summary-value">{{TOTAL_FEE}}</div>
                        <div class="summary-subtext">${{TOTAL_FEE_USD}}</div>
                    </div>
                </div>
            </section>

            <!-- ==================== FINANCIAL SUMMARY ==================== -->
            <div class="totals-feature">
                <div class="totals-header">
                    <h2 class="totals-title">üìà Historic Value</h2>
                </div>

                <div class="totals-grid">
                    <div class="total-item">
                        <div class="total-icon">üì•</div>
                        <div class="total-label">Total Received</div>
                        <div class="total-value">${{TOTAL_IN_USD}}</div>
                        <div class="total-subvalue">{{TOKENS_IN_COUNT}} tokens</div>
                    </div>

                    <div class="total-item">
                        <div class="total-icon">üì§</div>
                        <div class="total-label">Total Sent</div>
                        <div class="total-value">${{TOTAL_OUT_USD}}</div>
                        <div class="total-subvalue">{{TOKENS_OUT_COUNT}} tokens</div>
                    </div>


                </div>


            </div>

            <!-- ==================== AUDIT & VERIFICATION ==================== -->
            {{#if INCLUDE_AUDIT}}
            <section class="audit-section">
                <div class="audit-header">
                    <div class="audit-icon">üîç</div>
                    <div class="audit-title">
                        <h3>Audit Trail & Verification</h3>
                        <p>Data integrity and source verification</p>
                    </div>
                </div>

                <div class="audit-grid">
                    <div class="audit-item">
                        <div class="info-label">Price Data Source</div>
                        <div class="info-value">{{PRICE_SOURCE}}</div>
                        <div class="info-subtext">Queried: {{PRICE_TIMESTAMP}}</div>
                    </div>

                    <div class="audit-item">
                        <div class="info-label">RPC Provider</div>
                        <div class="info-value">{{RPC_PROVIDER}}</div>
                        <div class="info-subtext">{{RPC_ENDPOINT_SHORT}}</div>
                    </div>

                    <div class="audit-item">
                        <div class="info-label">Classification Method</div>
                        <div class="info-value">{{CLASSIFICATION_METHOD}}</div>
                        <div class="info-subtext">AI-Powered Analysis</div>
                    </div>

                    <div class="audit-item">
                        <div class="info-label">Reorg Detection</div>
                        <div class="info-value">{{#if REORG_DETECTED}}‚ö†Ô∏è Detected{{else}}‚úì Clear{{/if}}</div>
                        <div class="info-subtext">Last checked: {{REORG_CHECK_TIME}}</div>
                    </div>
                </div>

                <div class="confidence-meter">
                    <div class="confidence-label">Classification Confidence Score</div>
                    <div class="confidence-bar-wrapper">
                        <div class="confidence-bar-fill" data-width="{{CONFIDENCE_PERCENT}}%"></div>
                    </div>
                    <div class="confidence-value">{{CONFIDENCE}}% Confident</div>
                </div>
            </section>
            {{/if}}

            <!-- ==================== FOOTER GROUP (Keeps Ad, QR, Footer together) ==================== -->
            <div class="footer-group">
                <!-- ==================== AD SPACE ==================== -->
                <section class="ad-section">
                    {{#if hasAd}}
                    <div class="ad-content">
                        {{{adContent}}}
                    </div>
                    {{else}}
                    <div class="ad-placeholder">
                        <div class="ad-placeholder-title">üì£ Advertise Here</div>
                        <div class="ad-placeholder-text">
                            Reach thousands of blockchain users with your message.<br>
                            Contact us for premium ad placement opportunities.
                        </div>
                        <a href="mailto:sarkaritoolmail@gmail.com" class="ad-placeholder-link">Contact for Ads</a>
                    </div>
                    {{/if}}
                </section>

                <!-- ==================== QR CODE & VERIFICATION ==================== -->
                <section class="verification-section">
                    <h3 class="verification-title">üîê Blockchain Verification</h3>
                    <div class="qr-container">
                        <div class="qr-code">
                            <img src="{{QR_CODE_DATA_URL}}" alt="Transaction QR Code" />
                        </div>
                        <div class="qr-label">
                            Scan to verify on blockchain explorer<br>
                            <a href="{{EXPLORER_URL}}" class="qr-link">{{EXPLORER_URL}}</a>
                        </div>
                    </div>
                </section>

                <!-- ==================== FOOTER ==================== -->
                <footer class="footer">
                    <div class="footer-grid">
                        <div class="footer-section">
                            <h4>About This Bill</h4>
                            <p>
                                This transaction bill is generated from verified on-chain data sourced directly from the
                                {{CHAIN_NAME}} blockchain. All information is cryptographically verifiable through the
                                provided
                                transaction hash and can be independently confirmed on any blockchain explorer.
                            </p>
                            <p>
                                Bill ID: <span class="font-mono">{{BILL_ID}}</span><br>
                                Generated: {{GENERATED_AT}}<br>
                                Version: {{BILL_VERSION}}
                            </p>
                        </div>

                        <div class="footer-section">
                            <h4>Quick Links</h4>
                            <p><a href="{{EXPLORER_URL}}" class="footer-link">View on Explorer</a></p>
                            <p><a href="{{REGENERATE_URL}}" class="footer-link">Regenerate Bill</a></p>
                            <p><a href="https://blockbill.io/support" class="footer-link">Get Support</a></p>
                            <p><a href="https://blockbill.io/api" class="footer-link">API Documentation</a></p>
                        </div>

                        <div class="footer-section">
                            <h4>Contact</h4>
                            <p>Website: <a href="https://blockbill.io" class="footer-link">blockbill.io</a></p>
                            <p>Email: sarkaritoolmail@gmail.com</p>
                            <p>Twitter: @loftyabhi</p>
                            <p>Discord: /loftyabhi</p>
                        </div>
                    </div>

                    <div class="footer-bottom">
                        <p class="font-bold">Generated by Chain Receipt - Professional Blockchain Transaction
                            Intelligence
                        </p>
                        <div class="footer-legal">
                            <p>
                                This bill is provided for informational and accounting purposes only. While we strive
                                for
                                accuracy,
                                Chain Receipt is not responsible for any decisions made based on this information.
                                Always
                                verify
                                transaction
                                data independently on blockchain explorers. USD values are estimates based on market
                                data at
                                the
                                time
                                of transaction and may not reflect actual trading prices. This document does not
                                constitute
                                financial,
                                legal, or tax advice.
                            </p>
                            <p style="margin-top: 8px;">
                                ¬© 2025 Chain Receipt. All rights reserved. |
                                <a href="#" class="footer-link">Terms of Service</a> |
                                <a href="#" class="footer-link">Privacy Policy</a>
                            </p>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script>
            // Apply dynamic widths that might cause CSS validation errors if inline
            document.querySelectorAll('[data-width]').forEach(el => {
                el.style.width = el.getAttribute('data-width');
            });
        </script>
</body>

</html>