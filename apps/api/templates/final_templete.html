<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chain Receipt - Transaction Receipt {{BILL_ID}}</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        /* ==================== RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        :root {
            /* Palette: Slate & Indigo - Professional, Trustworthy */
            --color-bg: #ffffff;
            --color-surface: #f8fafc;
            --color-border: #e2e8f0;

            --color-text-primary: #0f172a;
            --color-text-secondary: #64748b;
            --color-text-tertiary: #94a3b8;

            --color-accent: #6366f1;
            /* Indigo 500 */
            --color-accent-light: #e0e7ff;
            --color-accent-dark: #4338ca;

            --color-success: #10b981;
            --color-success-bg: #ecfdf5;
            --color-success-text: #065f46;

            --color-danger: #ef4444;
            --color-danger-bg: #fef2f2;
            --color-danger-text: #991b1b;

            --color-warning: #f59e0b;
            --color-warning-bg: #fffbeb;
            --color-warning-text: #92400e;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-mono: 'JetBrains Mono', 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;

            /* Radius */
            --radius-sm: 4px;
            --radius-md: 6px;
            /* Tighter radius for professional look */
            --radius-lg: 8px;
        }

        @page {
            size: A4;
            /* Puppeteer handles margins */
        }

        body {
            font-family: var(--font-sans);
            background: var(--color-bg);
            color: var(--color-text-primary);
            font-size: 12px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .page {
            width: 100%;
            min-height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .page-content {
            flex: 1;
        }

        /* Helpers */
        .font-mono {
            font-family: var(--font-mono);
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-medium {
            font-weight: 500;
        }

        .text-secondary {
            color: var(--color-text-secondary);
        }

        .text-tertiary {
            color: var(--color-text-tertiary);
        }

        .text-accent {
            color: var(--color-accent);
        }

        .uppercase-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
            font-weight: 600;
        }

        /* ==================== HEADER ==================== */
        .header {
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .brand-icon {
            width: 32px;
            height: 32px;
            background: var(--color-text-primary);
            color: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .brand-info h1 {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text-primary);
            line-height: 1.2;
        }

        .brand-tagline {
            font-size: 10px;
            color: var(--color-text-secondary);
        }

        .receipt-meta {
            text-align: right;
        }

        .receipt-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: var(--space-xs);
            letter-spacing: -0.02em;
        }

        .receipt-id {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--color-text-secondary);
            background: var(--color-surface);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            display: inline-block;
        }

        /* ==================== STATUS BAR ==================== */
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-xl);
            padding: var(--space-md);
            background: var(--color-surface);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .status-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: var(--radius-md);
            /* Soft rect */
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-badge.confirmed {
            background-color: var(--color-success-bg);
            color: var(--color-success-text);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-badge.failed {
            background-color: var(--color-danger-bg);
            color: var(--color-danger-text);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .status-badge.pending {
            background-color: var(--color-warning-bg);
            color: var(--color-warning-text);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .chain-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .chain-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 500;
            color: var(--color-text-primary);
        }

        /* ==================== GRID LAYOUTS ==================== */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--color-border);
        }

        /* ==================== DATA POINTS ==================== */
        .data-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .data-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-primary);
            word-break: break-all;
        }

        .data-value.mono {
            font-family: var(--font-mono);
            font-size: 12px;
        }

        .data-value.large {
            font-size: 16px;
        }

        /* ==================== PARTICIPANTS ==================== */
        .participant-card {
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }

        .participant-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            padding-bottom: var(--space-sm);
            border-bottom: 1px dashed var(--color-border);
        }

        .avatar {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, var(--color-text-secondary), var(--color-text-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        /* ==================== TABLES ==================== */
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .table-container {
            margin-bottom: var(--space-xl);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th {
            text-align: left;
            padding: var(--space-sm) 0;
            border-bottom: 2px solid var(--color-border);
            color: var(--color-text-secondary);
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            /* Prevent wrapping */
        }

        /* Right align numeric columns specifically via class or nth-child */
        th.text-right {
            text-align: right;
        }

        td {
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--color-border);
            vertical-align: top;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .token-cell {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .direction-badge {
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            text-transform: uppercase;
        }

        .direction-in {
            color: var(--color-success-text);
            background: var(--color-success-bg);
        }

        .direction-out {
            color: var(--color-danger-text);
            background: var(--color-danger-bg);
        }

        .amount-positive {
            color: var(--color-success);
            font-weight: 600;
        }

        .amount-negative {
            color: var(--color-text-primary);
        }

        /* ==================== FINANCIAL SUMMARY ==================== */
        .financial-summary {
            display: flex;
            justify-content: flex-end;
            margin-bottom: var(--space-xl);
        }

        .summary-box {
            width: 300px;
            background: var(--color-surface);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
            font-size: 12px;
        }

        .summary-row.total {
            margin-top: var(--space-md);
            padding-top: var(--space-md);
            border-top: 1px solid var(--color-border);
            font-weight: 700;
            font-size: 14px;
            color: var(--color-text-primary);
        }

        /* ==================== FOOTER / AD / QR ==================== */
        .document-footer {
            margin-top: auto;
            padding-top: var(--space-xl);
            border-top: 1px solid var(--color-border);
        }

        .ad-container {
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--color-surface);
            border: 1px dashed var(--color-border);
            border-radius: var(--radius-md);
            text-align: center;
            page-break-inside: avoid;
            break-inside: avoid;
        }

        .ad-container img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .qr-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .qr-image {
            width: 80px;
            height: 80px;
            border: 4px solid white;
            box-shadow: 0 0 0 1px var(--color-border);
        }

        .footer-legal {
            font-size: 9px;
            color: var(--color-text-tertiary);
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        /* ==================== AUDIT SECTION ==================== */
        .audit-strip {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            /* Prevent splitting across pages */
            page-break-inside: avoid;
            break-inside: avoid;
            /* Ensure it starts on a new page if it doesn't fit, but avoid orphanage */
            display: block;
        }

        .audit-title {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--color-text-primary);
        }
    </style>
</head>

<body>
    <div class="page">
        <!-- HEADER -->
        <header class="page-content">
            <div class="header">
                <div class="brand">
                    <div class="brand-icon">‚ö°</div>
                    <div class="brand-info">
                        <h1>Chain Receipt</h1>
                        <div class="brand-tagline">Professional Blockchain Intelligence</div>
                    </div>
                </div>
                <div class="receipt-meta">
                    <h2 class="receipt-title">Transaction Receipt</h2>
                    <div class="receipt-id">#{{BILL_ID}}</div>
                    <div class="uppercase-label" style="margin-top: 4px;">{{GENERATED_AT}}</div>
                </div>
            </div>

            <!-- STATUS & NETWORK -->
            <div class="status-bar">
                <div class="status-indicator">
                    <span class="status-badge {{#if STATUS_CONFIRMED}}confirmed{{else}}failed{{/if}}">
                        {{#if STATUS_CONFIRMED}}‚úî Confirmed{{else}}‚úñ Failed{{/if}}
                    </span>
                    <span class="status-badge"
                        style="background:var(--color-surface); color:var(--color-text-secondary); border:1px solid var(--color-border);">
                        {{TYPE_READABLE}}
                    </span>
                    {{#if IS_MULTISIG}}<span class="status-badge"
                        style="background:#f0f9ff; color:#0369a1; border:1px solid #bae6fd;">üõ°Ô∏è Multisig</span>{{/if}}
                    {{#if IS_SMART_ACCOUNT}}<span class="status-badge"
                        style="background:#f3e8ff; color:#7e22ce; border:1px solid #d8b4fe;">ü§ñ Smart
                        Account</span>{{/if}}
                </div>
                <div class="chain-info">
                    <div class="chain-badge">
                        <span>{{CHAIN_ICON}}</span>
                        <span>{{CHAIN_NAME}} ({{CHAIN_ID}})</span>
                    </div>
                </div>
            </div>

            <!-- KEY DETAILS GRID -->
            <div class="grid-4">
                <div class="data-group">
                    <div class="uppercase-label">Timestamp</div>
                    <div class="data-value">{{TIMESTAMP}}</div>
                    <div class="text-secondary" style="font-size: 10px;">{{TIMESTAMP_RELATIVE}}</div>
                </div>
                <div class="data-group">
                    <div class="uppercase-label">Block Height</div>
                    <div class="data-value mono">#{{BLOCK_NUMBER}}</div>
                </div>
                <div class="data-group" style="grid-column: span 2;">
                    <div class="uppercase-label">Transaction Hash</div>
                    <div class="data-value mono" style="font-size: 11px;">{{TRANSACTION_HASH}}</div>
                </div>
            </div>

            <!-- PARTICIPANTS -->
            <div class="grid-2">
                <div class="participant-card">
                    <div class="participant-header">
                        <div class="uppercase-label">Sender (From)</div>
                    </div>
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                        <div class="avatar">{{FROM_AVATAR}}</div>
                        <div>
                            {{#if FROM_ENS}}<div class="data-value">{{FROM_ENS}}</div>{{/if}}
                            <div class="data-value mono" style="font-size: 11px; color: var(--color-text-secondary);">
                                {{FROM_ADDRESS}}</div>
                        </div>
                    </div>
                </div>
                <div class="participant-card">
                    <div class="participant-header">
                        <div class="uppercase-label">Recipient (To)</div>
                    </div>
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                        <div class="avatar">{{TO_AVATAR}}</div>
                        <div>
                            {{#if TO_ENS}}<div class="data-value">{{TO_ENS}}</div>{{/if}}
                            <div class="data-value mono" style="font-size: 11px; color: var(--color-text-secondary);">
                                {{TO_ADDRESS}}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INTERNAL TXS -->
            {{#if HAS_INTERNAL_TXS}}
            <div class="table-container">
                <div class="section-title">Internal Execution / Smart Contract Trace</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40%">Caller</th>
                            <th style="width: 40%">Target</th>
                            <th class="text-right" style="width: 20%">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each INTERNAL_TXS}}
                        <tr>
                            <td><span class="font-mono text-secondary">{{this.fromShort}}</span></td>
                            <td><span class="font-mono text-secondary">{{this.toShort}}</span></td>
                            <td class="text-right">
                                <span class="font-medium">{{this.amount}} {{this.symbol}}</span>
                                {{#if this.isError}}<span class="direction-badge direction-out"
                                    style="margin-left:5px;">FAIL</span>{{/if}}
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{/if}}

            <!-- LINE ITEMS -->
            <div class="table-container">
                <div class="section-title">Token Movements</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 10%">Type</th>
                            <th style="width: 25%">Asset</th>
                            <th style="width: 20%">From</th>
                            <th style="width: 20%">To</th>
                            <th class="text-right" style="width: 15%">Amount</th>
                            <th class="text-right" style="width: 10%">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each ITEMS}}
                        <tr>
                            <td>
                                <span class="direction-badge {{#if this.isIn}}direction-in{{else}}direction-out{{/if}}">
                                    {{#if this.isIn}}IN{{else}}OUT{{/if}}
                                </span>
                            </td>
                            <td>
                                <div class="token-cell">
                                    <span>{{this.tokenIcon}}</span>
                                    <span class="font-medium">{{this.tokenSymbol}}</span>
                                </div>
                            </td>
                            <td><span class="font-mono text-secondary">{{this.fromShort}}</span></td>
                            <td><span class="font-mono text-secondary">{{this.toShort}}</span></td>
                            <td class="text-right font-mono">{{this.amountFormatted}}</td>
                            <td class="text-right font-mono {{#if this.isIn}}amount-positive{{/if}}">{{this.usdValue}}
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>

            <!-- FINANCIAL SUMMARY & HISTORIC VALUE -->
            <div class="grid-2">
                <!-- Transaction Fees -->
                <div class="summary-box" style="width: 100%;">
                    <div class="summary-row total"
                        style="margin-top: 0; border: none; padding-top: 0; margin-bottom: 12px;">Transaction Cost</div>
                    <div class="summary-row">
                        <span class="text-secondary">Gas Price</span>
                        <span class="font-mono">{{GAS_PRICE_GWEI}} Gwei</span>
                    </div>
                    <div class="summary-row">
                        <span class="text-secondary">Gas Used</span>
                        <span class="font-mono">{{GAS_USED}}</span>
                    </div>
                    <div class="summary-row">
                        <span class="text-secondary">Total Fee</span>
                        <span class="font-mono">{{TOTAL_FEE}} {{CHAIN_SYMBOL}}</span>
                    </div>
                    <div class="summary-row"
                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed var(--color-border);">
                        <span class="font-medium">Cost in USD</span>
                        <span class="font-mono">${{TOTAL_FEE_USD}}</span>
                    </div>
                </div>

                <!-- Historic Value -->
                <div class="summary-box"
                    style="width: 100%; border: 1px solid var(--color-accent-light); background: #fdfcff;">
                    <div class="summary-row total"
                        style="margin-top: 0; border: none; padding-top: 0; margin-bottom: 12px; color: var(--color-accent-dark);">
                        Historic Value (On Tx Date)
                    </div>
                    <div class="summary-row">
                        <span class="text-secondary">Total Received</span>
                        <span class="font-mono">${{TOTAL_IN_USD}}</span>
                    </div>
                    <div class="summary-row">
                        <span class="text-secondary">Total Sent</span>
                        <span class="font-mono">${{TOTAL_OUT_USD}}</span>
                    </div>
                    <div class="summary-row"
                        style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed var(--color-accent-light);">
                        <span class="font-medium">Net Change</span>
                        <span
                            class="font-mono {{#if NET_CHANGE_POSITIVE}}amount-positive{{else}}amount-negative{{/if}}">
                            {{NET_CHANGE_SIGN}}${{NET_CHANGE_USD}}
                        </span>
                    </div>
                </div>
            </div>

            <!-- AUDIT -->
            {{#if INCLUDE_AUDIT}}
            <div class="audit-strip">
                <div class="audit-title">Verification & Audit Trail</div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                    <div class="data-group">
                        <div class="uppercase-label">Data Source</div>
                        <div class="data-value" style="font-size: 11px;">{{PRICE_SOURCE}}</div>
                    </div>
                    <div class="data-group">
                        <div class="uppercase-label">AI Confidence</div>
                        <div class="data-value" style="font-size: 11px;">{{CONFIDENCE}}%</div>
                    </div>
                    <div class="data-group">
                        <div class="uppercase-label">Method</div>
                        <div class="data-value" style="font-size: 11px;">{{CLASSIFICATION_METHOD}}</div>
                    </div>
                    <div class="data-group">
                        <div class="uppercase-label">Reorg Check</div>
                        <div class="data-value" style="font-size: 11px;">{{#if REORG_DETECTED}}‚ö†Ô∏è Detected{{else}}‚úì
                            Passed{{/if}}</div>
                    </div>
                </div>
            </div>
            {{/if}}

            <div style="margin-top: 40px;"></div>

            <!-- FOOTER GROUP -->
            <div class="document-footer">
                <div class="ad-container">
                    {{#if hasAd}}
                    {{{adContent}}}
                    {{else}}
                    <div style="color: var(--color-text-secondary); font-size: 11px;">
                        <strong>Promote your project here.</strong> Contact sarkaritoolmail@gmail.com
                    </div>
                    {{/if}}
                </div>

                <div class="qr-section">
                    <img src="{{QR_CODE_DATA_URL}}" class="qr-image" alt="QR Validation">
                    <div style="text-align: left;">
                        <div class="uppercase-label">Cryptographic Verification</div>
                        <div
                            style="font-size: 10px; color: var(--color-text-secondary); max-width: 250px; margin-top: 4px;">
                            Scan to verify this transaction on-chain. Reference Bill #{{BILL_ID}}.
                        </div>
                    </div>
                </div>

                <div class="footer-legal">
                    Generated by Chain Receipt ‚Ä¢ <a href="{{EXPLORER_URL}}"
                        style="color: var(--color-text-secondary);">View on Explorer</a> ‚Ä¢ <a href="#"
                        style="color: var(--color-text-secondary);">Regenerate</a><br>
                    <span style="font-size: 8px; color: #cbd5e1; display: block; margin-top: 8px;">
                        Disclaimer: This document is for informational purposes only. USD values are estimates at the
                        time of transaction.
                        Data is sourced directly from the {{CHAIN_NAME}} blockchain.
                        ¬© 2025 Chain Receipt.
                    </span>
                </div>
            </div>

            <div style="height: 40px;"></div>
        </header>
    </div>

    <!-- Script remains primarily to handle any dynamic resizing if needed -->
    <script>
        document.querySelectorAll('[data-width]').forEach(el => {
            el.style.width = el.getAttribute('data-width');
        });
    </script>
</body>

</html>